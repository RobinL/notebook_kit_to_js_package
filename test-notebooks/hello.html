<!doctype html>
<notebook>
    <title>Hello, world! (diff-match-patch demo)</title>

    <script id="1" type="text/markdown">
    # Hello, world! (diff-match-patch demo)

    Type into the boxes to see a live demo here
  </script>

    <script id="2" type="module">
        const one = view(Inputs.text({ label: "one", value: "robin jabba" }));

        ({ one })
    </script>

    <script id="3" type="module">

        const other = view(Inputs.text({ label: "other", value: "roin liinacre" }));



        ({ other })
    </script>




    <script id="4" type="module" output="diffOutput">
        import DiffMatchPatch from "diff-match-patch";

        const dmp = new DiffMatchPatch();

        const diffs = dmp.diff_main(one, other);


        const out = document.createElement("div");

        out.style.fontSize = "16px";
        out.style.lineHeight = "1.6";

        out.innerHTML = dmp.diff_prettyHtml(diffs);

        display(out);
        display(`Levenshtein distance: ${dmp.diff_levenshtein(diffs)}`);
    </script>

    <script id="5" type="module" output="message">
        import hello_world from "my-custom-lib";

        const message = hello_world();
        display(message);
        display(message);

    </script>

    <script id="6" type="module">


        const spec = {
            $schema: "https://vega.github.io/schema/vega-lite/v5.json",
            description: "Match weight distribution",
            data: {
                values: [{ "match_weight": 5.5, "count": 4 }, { "match_weight": 4.5, "count": 1 }],
            },
            mark: "bar",
            encoding: {
                x: {
                    field: "match_weight",
                    type: "nominal",
                    title: "Match weight",
                },
                y: {
                    aggregate: "count",
                    type: "quantitative",
                    title: "Count",
                },
            },
            params: [
                {
                    name: "selectBar",
                    select: {
                        "type": "point",
                        "on": "click",
                        "fields": ["match_weight"]
                    }
                }
            ]
        };

    </script>

    <script id="7" type="module">
        import vegaEmbed from "vega-embed";

        const container = document.createElement("div");
        const result = await vegaEmbed(container, spec, { actions: false });

        display(container);
        const chartView = result.view;
        invalidation.then(() => result.finalize());

    </script>

    <script id="8" type="module">
        function observeVegaSignal(view, signalName) {
            return Generators.observe((notify) => {
                const listener = (_name, value) => notify(value);

                view.addSignalListener(signalName, listener);
                notify(view.signal(signalName)); // initial value

                return () => view.removeSignalListener(signalName, listener);
            });
        }
    </script>

    <script id="9" type="module">
        const selectedBar = observeVegaSignal(chartView, "selectBar");
    </script>



    <script id="10" type="module">
        md`Your selected weight is : ${selectedBar?.match_weight?.[0] ?? "â€”"}`
    </script>

</notebook>