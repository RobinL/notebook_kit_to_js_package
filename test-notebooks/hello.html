<!doctype html>
<notebook>
    <title>Hello, world! (diff-match-patch demo)</title>

    <script id="1" type="text/markdown">
    # Hello, world! (diff-match-patch demo)

    Type into the boxes to see a live demo here
  </script>

    <script id="2" type="module">
        const one = view(Inputs.text({ label: "one", value: "robin jabba" }));

        ({ one })
    </script>

    <script id="3" type="module">

        const other = view(Inputs.text({ label: "other", value: "roin liinacre" }));



        ({ other })
    </script>




    <script id="4" type="module" output="diffOutput">
        import DiffMatchPatch from "diff-match-patch";

        const dmp = new DiffMatchPatch();

        const diffs = dmp.diff_main(one, other);


        const out = document.createElement("div");

        out.style.fontSize = "16px";
        out.style.lineHeight = "1.6";

        out.innerHTML = dmp.diff_prettyHtml(diffs);

        display(out);
        display(`Levenshtein distance: ${dmp.diff_levenshtein(diffs)}`);
    </script>

    <script id="5" type="module" output="message">
        import hello_world from "my-custom-lib";

        const message = hello_world();
        display(message);
        display(message);

    </script>

    <script id="6" type="module">


        const spec = {
            $schema: "https://vega.github.io/schema/vega-lite/v5.json",
            description: "Match weight distribution",
            data: {
                values: [{ "match_weight": 5.5, "count": 4 }, { "match_weight": 4.5, "count": 1 }],
            },
            mark: "bar",
            encoding: {
                x: {
                    field: "match_weight",
                    type: "nominal",
                    title: "Match weight",
                },
                y: {
                    aggregate: "count",
                    type: "quantitative",
                    title: "Count",
                },
            },
            params: [
                {
                    name: "selectBar",
                    select: {
                        "type": "point",
                        "on": "click",
                        "fields": ["match_weight"]
                    }
                }
            ]
        };

    </script>

    <script id="7" type="module">
        import vegaEmbed from "vega-embed";
        const container = document.createElement("div");

        const chart_embeded = await vegaEmbed(container, spec);
        const vegaView = chart_embeded.view;



        display(container)
    </script>

    <script id="8" type="module">
        // Cell 2: Create a reactive generator for the signal
        const selectBar = (async function* () {
            let resolve;
            let current = vegaView.signal("selectBar");

            const handler = (name, value) => {
                debugger;
                current = value;

                if (resolve) resolve();
            };

            vegaView.addSignalListener("selectBar", handler);



            // Clean up when cell is invalidated/re-run
            invalidation.then(() => {
                vegaView.removeSignalListener("selectBar", handler);
            });

            yield current; // Initial value
            while (true) {
                await new Promise(r => resolve = r);
                yield current;
            }
        })();

    </script>

    <script id="9" type="module">
        // Cell 3: Use the reactive value
        display(html`Selected: ${selectBar?.a ?? "nothing"} with value ${selectBar?.b ?? "â€”"}`);

    </script>


</notebook>